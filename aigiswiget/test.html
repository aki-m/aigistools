<html>
<head>
<title></title>
</head>
<body>
test
<span id="cnt"></span>
<a id="dl" target="_blank" href="#" download="test.wav" ></a>
<script>
var cnt=0;
var buf=new MediaStream();
var recorder = null;

var bkplay=Audio.prototype.play;
Audio.prototype.play=function(){
   cnt++;
   document.getElementById("cnt").innerText=""+cnt;


   for( var i in buf.getAudioTracks() ) buf.removeTrack(i);
   var s=this.captureStream();
   s=s.getAudioTracks();
   for( var i in s ){
     buf.addTrack(i);
   }
   a.onaddtrack=function(ev3){
     buf.addTrack(ev3);

   if( ! recorder ){
     recorder = new MediaRecorder(buf);
     recorder.ondataavailable = function(e){
       var obj=document.getElementById("dl");
       obj.href=window.URL.createObjectURL(e.data);
       obj.click();
     };
     recorder.start();
   }


   }

   bkplay.call(this);
};

var a=new Audio("");
var oneplay=function(){
  if( cnt < 5 ){
    a.src="click.vorb"
    a.play();
  }else recorder.stop();
}
document.body.onload=function(ev){
  a.addEventListener("ended",oneplay);
  oneplay();
}
</script>
</body>
</html>
